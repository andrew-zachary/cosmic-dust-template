---
import Base from '../../../layouts/Base.astro';
import List from '../../../layouts/List.astro';
import Categories from '../../../layouts/Categories.astro';

import Section from '../../../components/articles/index/section.astro';

import translationsMeta from '../../../locals/meta.json';
import cats from '../../../locals/cats.json';

const {cat, lang} = Astro.params;

// get current catKey
let selectedCat = null;
for (const catKey in cats) {
    if(cats[catKey][lang].slug === cat) {
        selectedCat = catKey;
        break;
    }
}

// filter mdxFiles by selectedCat(catKey)
const mdxFiles = await Astro.glob('../../../data/*.mdx');
const filteredMdxFiles = mdxFiles.filter(mdxFile => mdxFile['content']['cats'].includes(selectedCat))

// export params (lang, cat)
export async function getStaticPaths() {

    const params = [];

    Object.keys(translationsMeta).forEach(metaLang => {
        Object.keys(cats).forEach(catKey => {
            params.push({params: {lang: translationsMeta[metaLang].name, cat: cats[catKey][translationsMeta[metaLang].name].slug}});
        });
    });

    return params;
}
---

<Base title={cat.replace('-', ' ')}>
    <Section />
    <Categories selectedCat={selectedCat} cats={cats} />
    <List mdxFiles={filteredMdxFiles} />
</Base>

<style></style>
